#!/bin/bash

# Block committing repository-internal guides (only when added/modified)
if git diff --cached --diff-filter=AM --name-only | grep -Ei '(^|/)(agents\.md|workflows\.md)$' >/dev/null; then
    echo "Commit blocked: do not commit AGENTS.md/WORKFLOWS.md (local-only docs)."
    echo "Add them to .gitignore (already done) and unstage with: git restore --staged <file>"
    exit 1
fi

#pnpm pretty-quick --staged

if git diff --cached --name-only | grep -q '^src/'; then
    pnpm format:check
    if [ $? -ne 0 ]; then
        echo "Code format check failed in src/. Please fix formatting issues."
        exit 1
    fi
fi

if git diff --cached --name-only | grep -q '^src-tauri/'; then
    cd src-tauri
    cargo fmt
    if [ $? -ne 0 ]; then
        echo "rustfmt failed to format the code. Please fix the issues and try again."
        exit 1
    fi
    cd ..
fi

#git add .

# 允许提交
exit 0
